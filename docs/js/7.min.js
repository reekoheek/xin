(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{47:function(t,e,i){"use strict";i.r(e);var s=i(9),r=i(0),a=i(8);class n{static routeRegExp(t){const e=t.split("[");if(e.length>2)throw new Error("Invalid use of optional params");const i=[],s=e[0].replace(/{([^}]+)}/g,function(t,e){return i.push(e),"([^/]+)"}).replace(/\//g,"\\/");let r="";return e[1]&&(r="(?:"+e[1].slice(0,-1).replace(/{([^}]+)}/g,function(t,e){const[s,r="[^/]+"]=e.split(":");return i.push(s),`(${r})`}).replace(/\//g,"\\/")+")?"),[new RegExp("^"+s+r+"$"),i]}static isStatic(t){return!t.match(/[[{]/)}constructor(t,e){if(this.route=t,this.callback=e,n.isStatic(t))this.type="s",this.pattern=null,this.args=[];else{const e=n.routeRegExp(t);this.type="v",this.pattern=e[0],this.args=e[1]}}getExecutorFor(t){if("s"===this.type){if(t===this.route)return{handler:this,args:{}}}else if("v"===this.type){const e=t.match(this.pattern);if(e)return{handler:this,args:this.args.reduce((t,i,s)=>(t[i]=e[s+1],t),{})}}}}var o=i(49),h=i.n(o);const c=i(7)("xin:components:app"),l=window.URL;class u extends a.a{get props(){return{title:{type:String,observer:"_titleChanged"},manual:{type:Boolean},mode:{type:String,value:"hash"},rootUri:{type:String,value:"/"},hash:{type:String,value:"#!"},startDelay:{type:Number,value:100},location:{type:Object,value:()=>window.location},history:{type:Object,value:()=>window.history}}}get hashRegexp(){return this._hashRegexp&&this._hash===this.hash||(this._hashRegexp=new RegExp(`${this.hash}(.*)$`),this._hash=this.hash),this._hashRegexp}notFound(t){console.warn(`Route not found: ${t}`)}_titleChanged(t){t&&(document.title=t)}created(){this.__appSignature=!0,this.handlers=[],this.middlewares=[],this.__started=!1,this.__starting=!1,this.classList.add("xin-app")}attached(){this.manual||this.async(()=>{this.start()},1)}detached(){super.detached(),"history"===this.mode?(Object(r.c)(window).off("popstate",this.__navCallback),Object(r.c)(document).off("click",this.__clickCallback),delete this.__clickCallback):Object(r.c)(window).off("hashchange",this.__navCallback),delete this.__navCallback}route(t,e){this.handlers.push(new n(t,e))}async start(){if(this.__started||this.__starting)return;this.__middlewareChainRun=function(t){for(const e of t)if("function"!=typeof e)throw new TypeError("Middleware must be composed of functions!");return(e,i)=>{let s=-1;return function r(a){if(a<=s)throw new Error("next() called multiple times");s=a;let n=t[a];a===t.length&&(n=i);if(!n)return;return n(e,()=>r(a+1))}(0)}}(this.middlewares),this.__listenNavigation(),c.enabled&&c(`Starting ${this.is}:${this.__id} ...`),this.__starting=!0;const t=await this.__execute();this.async(()=>{this.__starting=!1,t&&(c.enabled&&c(`Started ${this.is}:${this.__id}`),this.__started=!0,this.fire("started"))},this.startDelay)}__listenNavigation(){this.__navCallback=()=>{this.__execute()},"history"===this.mode?(this.__clickCallback=t=>{if(!t.defaultPrevented&&"A"===t.target.nodeName&&""===t.target.target){t.preventDefault();const e={url:t.target.getAttribute("href")};this.history.pushState(e,t.target.innerHTML,t.target.href),this.__navCallback()}},Object(r.c)(window).on("popstate",this.__navCallback),Object(r.c)(document).on("click",this.__clickCallback)):Object(r.c)(window).on("hashchange",this.__navCallback)}get started(){return this.__started||!1}getFragmentExecutors(t){return this.handlers.reduce((e,i)=>{const s=i.getExecutorFor(t);return s&&e.push(s),e},[])}async __execute(){const t=this.__navParameters;delete this.__navParameters;const e=this.getFragment(),{pathname:i,search:s}=new l(e,"http://localhost"),r="?"===s[0]?s.substr(1):s,a=h.a.parse(r),n={app:this,uri:e,pathname:i,queryParameters:a,navParameters:t};return!1!==await this.__middlewareChainRun(n,()=>{const i=this.getFragmentExecutors(n.pathname);if(0===i.length)return this.notFound(e),void this.fire("route-not-found",e);i.forEach(e=>{const i=Object.assign({},e.args,a,t);e.handler.callback(i,n)})})&&(this.fire("navigated",n),!0)}navigate(t="/",e={}){if(this.__navParameters=e.parameters,"history"===this.mode){const i=this.rootUri+t.toString().replace(/\/$/,"").replace(/^\//,"");this.location.href.replace(this.location.origin,"")!==i&&(this.history[e.replace?"replaceState":"pushState"](this.__navParameters,document.title,i),this.__execute())}else e.replace?this.location.replace(this.hash+t):this.location.hash=this.hash+t;return this}use(t){this.middlewares.push(t)}getFragment(){try{let t;if("history"===this.mode)t=(t=decodeURI(this.location.pathname+this.location.search)).replace(/\?(.*)$/,""),t="/"===this.rootUri?t:t.replace(this.rootUri,"");else{const e=this.location.href.match(this.hashRegexp);t=e?e[1]:""}return"/"+t.toString().replace(/\/$/,"").replace(/^\//,"")}catch(t){return console.error("Fragment is not match any pattern, fallback to /"),"/"}}}Object(a.c)("xin-app",u);var d=i(4);Object(a.c)("xin-fixture",class extends a.a{static create(t,e={}){const i=document.createElement("div");i.innerHTML=`<xin-fixture><template>${t}</template></xin-fixture>`;const s=i.firstElementChild;return s.__initialData=e,document.body.appendChild(s),new Promise(t=>t(s))}attached(){super.attached(),this.set(this.__initialData),this.connected=!0,this.async(()=>this.fire("connected"))}detached(){super.detached(),this.connected=!1,this.fire("disconnected")}dispose(){this.parentElement.removeChild(this)}async waitConnected(t){this.connected||await this.waitFor("connected"),await d.a.sleep(t)}});class p extends a.a{attached(){super.attached(),this.__app.use(this.callback())}}Object(a.c)("xin-pager",class extends a.a{ready(){super.ready();for(let t=this.firstElementChild,e=0;t;t=t.nextElementSibling,e++)t.setAttribute("index",e)}setFocus(t){if(t){const e=t.getAttribute("index"),i=this.focused$?this.focused$.getAttribute("index"):-1;i<e?this.__transitionForward(this.focused$,t):i>e&&this.__transitionBackward(this.focused$,t)}else this.focused$&&this.focused$.setFocus(!1);this.focused$=t}__transitionBackward(t,e){Promise.all([e.inFx.play(-1),t.outFx.play(-1)]).then(()=>{t.setVisible(!1),e.setVisible(!0),t.setFocus(!1),e.setFocus(!0),this.$focused=e,e.inFx.stop(),t.outFx.stop()})}__transitionForward(t,e){if(t)Promise.all([e.inFx.play(1),t.outFx.play(1)]).then(()=>{t.setVisible(!1),e.setVisible(!0),t.setFocus(!1),e.setFocus(!0),this.$focused=e,e.inFx.stop(),t.outFx.stop()});else{const t=new r.a({element:e,transition:"none"});t.play("in",1).then(()=>{e.setVisible(!0),e.setFocus(!0),this.$focused=e,t.stop()})}}});var _=i(5);class m extends a.b{constructor(t,e,i,s){super(),this.__repeat=e,this.__repeatAs=e.as,this.__repeatIndexAs=e.indexAs,this.__templateInitialize(t,e.__templateModel,e.__templateMarker),this.is="$repeat-row",this.__id=this.__templateId,this.__templateChildNodes.forEach(t=>{t.nodeType===window.Node.ELEMENT_NODE&&(t.__repeatModel=this)}),this.update(i,s),this.__templateRender()}get __app(){return this.__templateHost.__app}update(t,e){this[this.__repeatAs]=t,this[this.__repeatIndexAs]=e,this.notify(this.__repeatAs,t),this.notify(this.__repeatIndexAs,e)}set(t,e){if(1!==arguments.length||"object"!=typeof t){if((t=this.__templateGetPathAsArray(t))[0]===this.__repeatAs||t[0]===this.__repeatIndexAs)return super.set(t,e)}else{const e=t;for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&this.set(t,e[t])}}get(t){return(t=this.__templateGetPathAsArray(t))[0]===this.__repeatAs||t[0]===this.__repeatIndexAs?super.get(t):this.__templateHost.get(t)}__templateAnnotate(t,e){if(!super.__templateAnnotate(t,e))return!1;const i=this.__templateGetPathAsArray(t.name);if(i[0]===this.__repeatAs||i[0]===this.__repeatIndexAs)return!0;for(const t in this.__templateBindings)t===i[0]&&delete this.__templateBindings[t];if("m"===t.type){const i=new _.a(this,t,e);this.__templateHost.__templateGetBinding(t.fn.name).annotate(i)}const s=new _.a(this.__templateHost,t,e);return t.vpaths.forEach(t=>{this.__templateHost.__templateGetBinding(t.name).annotate(s)}),e.set(t.invoke(this.__templateHost)),!0}__templateUninitialize(){super.__templateUninitialize()}}const f=()=>!0;Object(a.c)("xin-for",class extends a.a{get props(){return Object.assign({},super.props,{items:{type:Array,observer:"_itemsChanged(items, filter)"},as:{type:String,value:"item"},indexAs:{type:String,value:"index"},filter:{type:Function,observer:"_itemsChanged(items, filter)"},to:{type:String,value:""}})}created(){super.created(),this.rows=[]}__initTemplate(){if(this.__templateFor=this.firstElementChild,!this.__templateFor)throw new Error('Invalid xin-for definition, must be <xin-for items="[[items]]"><template>...</template></xin-for>');this.removeChild(this.__templateFor);let t=this;const e=this.getAttribute("to");if(e){const i=this.parentElement.querySelector(e)||document.querySelector(e);if(!i)throw new Error(`xin-for render to unknown element ${e}`);t=document.createComment("marker-for"),i.appendChild(t)}a.b.prototype.__templateInitialize.call(this,null,this,t)}_itemsChanged(t,e){this.debounce("_itemsChanged",()=>{let e=0;if(t&&t.length){const i=this.filter||f;t.filter(i).forEach((t,i)=>{this.rows[i]?this.rows[i].update(t,i):this.rows.push(new m(this.__templateFor,this,t,i)),e++})}this.rows.splice(e).forEach(t=>{t.__templateUninitialize()})})}itemForElement(t){return this.modelForElement(t).get(this.as)}indexForElement(t){return this.modelForElement(t).get(this.indexAs)}modelForElement(t){for(;t&&!t.__repeatModel;)t=t.parentElement;return t.__repeatModel}});i(48);class w{constructor(t,e,i){this.name=e.nodeName.toLowerCase(),this.uri=e.getAttribute("uri"),this.element=e,this.loader=i,this.route=new n(this.uri),this.isStaticRoute=n.isStatic(this.uri),this.bag=t}get loaded(){if(this._loaded)return!0;return!!this.element.classList.contains("xin-view")&&(this._loaded=!0,!0)}async load(){if(!this.loaded){if(!this.loader)throw new Error(`Cannot lazy load view: ${this.name}`);this.loader.load(this),await Object(r.c)(this.element).waitFor("routed"),this._loaded=!0,this.element.querySelector(".xin-view")&&await d.a.sleep(300)}}}Object(a.c)("xin-lazy-view-middleware",class extends p{get props(){return Object.assign({},super.props,{loaders:{type:Array,value:()=>this.__repository.get("view.loaders")?this.__repository.get("view.loaders"):[]}})}created(){super.created(),this.views=[]}attached(){super.attached(),this.loaders.push({test:/^xin-/,load(t){if("xin-view"===t.name)return Promise.resolve().then(i.bind(null,48))}})}get(t){const e=this.views.find(e=>e.uri===t);return e||this.views.find(e=>!(!e.isStaticRoute||e.uri!==t)||e.route.getExecutorFor(t))}put(t){this.views.push(t)}ensure(t,e){0===this.views.length&&t.querySelectorAll("[lazy-view]").forEach(t=>{const e=this.loaders.find(e=>t.nodeName.toLowerCase().match(e.test)),i=new w(this,t,e);this.put(i)});const i=this.get(e);if(i)return i.load()}callback(t){const e=this;return async function(t,i){await e.ensure(t.app,t.pathname),await i()}}});Object(a.c)("xin-title-middleware",class extends p{get props(){return Object.assign({},super.props,{defaultTitle:{type:String,value:"Xin"},formatter:{type:Function,value:()=>this._defaultFormatter}})}callback(t){const e=this;return async function(t,i){t.app.once("focus",async t=>{document.title=await e.formatter(t.target)||e.defaultTitle}),await i()}}_defaultFormatter(t){return t.title}});Object(s.b)("x-redirect-middleware",class extends p{callback(t){return async function(t,e){-1===[...document.querySelector("xin-pager").children].map(t=>t.getAttribute("uri")).indexOf(t.uri)&&(t.uri="/not-found"),await e()}}});Object(s.b)("x-app",class extends u{get template(){return i(52)}})},48:function(t,e,i){"use strict";i.r(e);var s=i(8),r=i(0);class a extends s.a{get props(){const t=this.__repository.get("view.transitionIn")||this.__repository.get("view.transition")||"slide",e=this.__repository.get("view.transitionOut")||this.__repository.get("view.transition")||"fade";return Object.assign({},super.props,{uri:{type:String,required:!0},transitionIn:{type:String,value:t},transitionOut:{type:String,value:e},title:{type:String,value:()=>`View ${this.uri}`}})}focusing(){}focused(){}blurred(){}created(){super.created(),this.classList.add("xin-view")}ready(){super.ready(),this.inFx=new r.a({element:this,transition:this.transitionIn,method:"in"}),this.outFx=new r.a({element:this,transition:this.transitionOut,method:"out"})}attached(){super.attached(),this.classList.remove("xin-view--focus"),this.classList.remove("xin-view--visible"),this.__app?(this.__app.route(this.uri,t=>{this.focus(t)}),this.fire("routed")):console.error("Cannot route view to undefined app")}async focus(t={}){this.set("parameters",t),await this.focusing(t),this.fire("focusing",t),this.async(()=>{"setFocus"in this.parentElement?this.parentElement.setFocus(this):(this.setVisible(!0),this.setFocus(!0))})}setVisible(t){if(t)return this.classList.add("xin-view--visible"),void this.fire("show",{view:this});this.classList.remove("xin-view--visible"),this.querySelectorAll(".xin-view.xin-view--visible").forEach(e=>e.setVisible(t)),this.fire("hide",{view:this})}async setFocus(t){if(t)return this.classList.add("xin-view--focus"),await this.focused(),void this.fire("focus",{view:this});this.classList.remove("xin-view--focus"),this.querySelectorAll(".xin-view.xin-view--focus").forEach(e=>{"setFocus"in e.parentElement?e.parentElement.setFocus(null):e.setFocus(t)}),await this.blurred(),this.fire("blur",{view:this})}}Object(s.c)("xin-view",a),i.d(e,"View",function(){return a})},49:function(t,e,i){"use strict";e.decode=e.parse=i(50),e.encode=e.stringify=i(51)},50:function(t,e,i){"use strict";function s(t,e){return Object.prototype.hasOwnProperty.call(t,e)}t.exports=function(t,e,i,a){e=e||"&",i=i||"=";var n={};if("string"!=typeof t||0===t.length)return n;var o=/\+/g;t=t.split(e);var h=1e3;a&&"number"==typeof a.maxKeys&&(h=a.maxKeys);var c=t.length;h>0&&c>h&&(c=h);for(var l=0;l<c;++l){var u,d,p,_,m=t[l].replace(o,"%20"),f=m.indexOf(i);f>=0?(u=m.substr(0,f),d=m.substr(f+1)):(u=m,d=""),p=decodeURIComponent(u),_=decodeURIComponent(d),s(n,p)?r(n[p])?n[p].push(_):n[p]=[n[p],_]:n[p]=_}return n};var r=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}},51:function(t,e,i){"use strict";var s=function(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}};t.exports=function(t,e,i,o){return e=e||"&",i=i||"=",null===t&&(t=void 0),"object"==typeof t?a(n(t),function(n){var o=encodeURIComponent(s(n))+i;return r(t[n])?a(t[n],function(t){return o+encodeURIComponent(s(t))}).join(e):o+encodeURIComponent(s(t[n]))}).join(e):o?encodeURIComponent(s(o))+i+encodeURIComponent(s(t)):""};var r=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};function a(t,e){if(t.map)return t.map(e);for(var i=[],s=0;s<t.length;s++)i.push(e(t[s],s));return i}var n=Object.keys||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.push(i);return e}},52:function(t,e){t.exports='<x-redirect-middleware></x-redirect-middleware> <xin-lazy-view-middleware></xin-lazy-view-middleware> <xin-pager> <xin-view lazy-view uri=/ > <template> <div class="padding container"> <h1>xin</h1> <p>A WebComponents based framework. We love npm, webpack and ofcourse webcomponents specs.</p> <div class=list> <a href=#!/intro>Intro</a> <a href=#!/binding>Binding</a> <a href=#!/app-route>App, views and routing</a> <a href=#!/component>Component</a> <a href=#!/middleware>Middleware</a> <div class=list__separator>Components</div> <a href=#!/fixture>xin-fixture</a> <a href=#!/for>xin-for</a> <div class=list__separator>Advanced</div> <a href=#!/advanced>Advanced topics</a> </div> </div> </template> </xin-view> <x-intro lazy-view uri=/intro></x-intro> <x-binding lazy-view uri=/binding></x-binding> <x-app-route lazy-view uri=/app-route></x-app-route> <x-component lazy-view uri=/component></x-component> <x-middleware lazy-view uri=/middleware></x-middleware> <x-for lazy-view uri=/for></x-for> <xin-view lazy-view uri=/advanced> <div class="padding container"> <h2>Advanced topics</h2> <h3>Defer</h3> <ul> <li>Async</li> <li>Debounce</li> <li>NextFrame</li> </ul> <h3>Events</h3> <ul> <li>component.fire()</li> <li>component.on()</li> </ul> </div> </xin-view> <xin-view lazy-view uri=/not-found> <div class=aligner> <div class=aligner-item> <p> Oops, route not found. Sorry... </p> <a href=#!/ >Home</a> </div> </div> </xin-view> </xin-pager> '}}]);